<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>智能每日记录系统</title>
    <style>
         :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #f9f9f9;
        }
        
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: var(--background-color);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .date-header {
            font-family: '黑体', 'SimHei', sans-serif;
            font-size: 24px;
            color: var(--primary-color);
        }
        
        .nav-buttons button {
            padding: 8px 15px;
            margin-left: 10px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        hr {
            border: 0;
            border-top: 2px solid var(--primary-color);
            margin: 20px 0;
        }
        
        .time-block {
            display: flex;
            margin: 15px 0;
            transition: transform 0.2s;
        }
        
        .time-block:hover {
            transform: translateX(5px);
        }
        
        .time {
            font-family: '楷体', 'KaiTi', cursive;
            width: 80px;
            margin-right: 20px;
            color: var(--primary-color);
        }
        
        .content {
            font-family: '仿宋', 'FangSong', serif;
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 60px;
        }
        
        .common-phrases {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        
        .phrase-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 8px 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        .export-section {
            margin-top: 30px;
            text-align: center;
        }
        
        .stats {
            margin: 20px 0;
            padding: 15px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="date-header" id="dateHeader"></div>
        <div class="nav-buttons">
            <button onclick="changeDate(-1)">前一天</button>
            <button onclick="changeDate(1)">后一天</button>
        </div>
    </div>
    <hr>
    <div class="stats" id="stats"></div>
    <div id="entries"></div>
    <button onclick="addEntry()">➕ 新增记录块</button>

    <div class="common-phrases">
        <h3>📝 常用短语：</h3>
        <div class="phrase-buttons">
            <button onclick="insertPhrase('今日工作进展：')">工作进展</button>
            <button onclick="insertPhrase('需要注意：')">注意事项</button>
            <button onclick="insertPhrase('明日计划：')">明日计划</button>
            <button onclick="insertPhrase('会议记录：')">会议记录</button>
            <button onclick="insertPhrase('临时任务：')">临时任务</button>
        </div>
    </div>

    <div class="export-section">
        <button onclick="exportDoc()">📤 导出Word文档</button>
        <button onclick="backupData()">💾 备份数据</button>
        <button onclick="restoreData()">📥 恢复数据</button>
    </div>

    <script src="https://unpkg.com/docx@7.7.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

    <script>
        let currentDate = new Date();
        let entries = [];

        // 初始化系统
        function init() {
            updateDateDisplay();
            loadData();
            updateStats();
            setInterval(autoSave, 30000); // 30秒自动保存
        }

        // 日期处理相关函数
        function formatDate(date) {
            return `${date.getFullYear()}年${pad(date.getMonth()+1)}月${pad(date.getDate())}日`;
        }

        function getDateKey(date) {
            return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())}`;
        }

        function pad(num) {
            return num.toString().padStart(2, '0');
        }

        // 数据存储相关函数
        function saveData() {
            const data = {
                entries: entries,
                updatedAt: new Date().toISOString()
            };
            localStorage.setItem(getDateKey(currentDate), JSON.stringify(data));
        }

        function loadData() {
            const data = localStorage.getItem(getDateKey(currentDate));
            entries = data ? JSON.parse(data).entries : [];
            renderEntries();
            if (entries.length === 0) addEntry();
        }

        // 界面渲染函数
        function renderEntries() {
            const container = document.getElementById('entries');
            container.innerHTML = '';

            entries.forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'time-block';
                entryDiv.innerHTML = `
                    <div class="time">${entry.time}</div>
                    <textarea class="content" rows="2">${entry.content}</textarea>
                    <button class="delete-btn" onclick="deleteEntry(${index})">×</button>
                `;

                const textarea = entryDiv.querySelector('textarea');
                textarea.addEventListener('input', () => {
                    entries[index].content = textarea.value;
                    saveData();
                    updateStats();
                });

                container.appendChild(entryDiv);
            });
        }

        // 核心功能函数
        function addEntry() {
            const time = new Date().toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit'
            });
            entries.push({
                time,
                content: ''
            });
            renderEntries();
            saveData();
            updateStats();
        }

        function deleteEntry(index) {
            if (confirm('确定要删除这个记录吗？')) {
                entries.splice(index, 1);
                renderEntries();
                saveData();
                updateStats();
            }
        }

        function changeDate(offset) {
            currentDate.setDate(currentDate.getDate() + offset);
            updateDateDisplay();
            loadData();
            updateStats();
        }

        // 辅助功能函数
        function updateDateDisplay() {
            document.getElementById('dateHeader').textContent = formatDate(currentDate);
        }

        function updateStats() {
            const totalEntries = entries.length;
            const totalChars = entries.reduce((sum, entry) => sum + entry.content.length, 0);
            document.getElementById('stats').innerHTML = `
                📊 统计：今日记录块 ${totalEntries} 个，总字数 ${totalChars}
            `;
        }

        function insertPhrase(phrase) {
            if (entries.length === 0) addEntry();
            const lastEntry = entries[entries.length - 1];
            lastEntry.content += phrase;
            renderEntries();
            saveData();
        }

        // 数据备份/恢复功能
        function backupData() {
            const allData = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    allData[key] = localStorage.getItem(key);
                }
            }
            const blob = new Blob([JSON.stringify(allData)], {
                type: 'application/json'
            });
            saveAs(blob, `daily-records-backup-${new Date().toISOString().slice(0,10)}.json`);
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = () => {
                    const data = JSON.parse(reader.result);
                    Object.keys(data).forEach(key => {
                        localStorage.setItem(key, data[key]);
                    });
                    alert('数据恢复成功！');
                    location.reload();
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // 导出功能
        async function exportDoc() {
            const doc = new docx.Document();

            // 标题部分
            doc.addSection({
                children: [
                    new docx.Paragraph({
                        text: formatDate(currentDate),
                        heading: docx.HeadingLevel.HEADING_1,
                        font: '黑体'
                    }),
                    new docx.Paragraph({
                        text: "",
                        border: {
                            bottom: {
                                color: "auto",
                                space: 1,
                                style: "single",
                                size: 6
                            }
                        }
                    })
                ]
            });

            // 内容部分
            entries.forEach(entry => {
                doc.addSection({
                    children: [
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: entry.time,
                                    font: '楷体'
                                }),
                                new docx.TextRun({
                                    text: "\t" + entry.content,
                                    font: '仿宋'
                                })
                            ],
                            spacing: {
                                after: 200
                            }
                        })
                    ]
                });
            });

            // 生成文件
            const blob = await docx.Packer.toBlob(doc);
            saveAs(blob, `${formatDate(currentDate)}.docx`);
        }

        // 初始化
        init();
    </script>
</body>

</html>
