<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>æ™ºèƒ½æ¯æ—¥è®°å½•ç³»ç»Ÿ</title>
    <style>
         :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #f9f9f9;
        }
        
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: var(--background-color);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .date-header {
            font-family: 'é»‘ä½“', 'SimHei', sans-serif;
            font-size: 24px;
            color: var(--primary-color);
        }
        
        .nav-buttons button {
            padding: 8px 15px;
            margin-left: 10px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        hr {
            border: 0;
            border-top: 2px solid var(--primary-color);
            margin: 20px 0;
        }
        
        .time-block {
            display: flex;
            margin: 15px 0;
            transition: transform 0.2s;
        }
        
        .time-block:hover {
            transform: translateX(5px);
        }
        
        .time {
            font-family: 'æ¥·ä½“', 'KaiTi', cursive;
            width: 80px;
            margin-right: 20px;
            color: var(--primary-color);
        }
        
        .content {
            font-family: 'ä»¿å®‹', 'FangSong', serif;
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 60px;
        }
        
        .common-phrases {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        
        .phrase-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 8px 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        .export-section {
            margin-top: 30px;
            text-align: center;
        }
        
        .stats {
            margin: 20px 0;
            padding: 15px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="date-header" id="dateHeader"></div>
        <div class="nav-buttons">
            <button onclick="changeDate(-1)">å‰ä¸€å¤©</button>
            <button onclick="changeDate(1)">åä¸€å¤©</button>
        </div>
    </div>
    <hr>
    <div class="stats" id="stats"></div>
    <div id="entries"></div>
    <button onclick="addEntry()">â• æ–°å¢è®°å½•å—</button>

    <div class="common-phrases">
        <h3>ğŸ“ å¸¸ç”¨çŸ­è¯­ï¼š</h3>
        <div class="phrase-buttons">
            <button onclick="insertPhrase('ä»Šæ—¥å·¥ä½œè¿›å±•ï¼š')">å·¥ä½œè¿›å±•</button>
            <button onclick="insertPhrase('éœ€è¦æ³¨æ„ï¼š')">æ³¨æ„äº‹é¡¹</button>
            <button onclick="insertPhrase('æ˜æ—¥è®¡åˆ’ï¼š')">æ˜æ—¥è®¡åˆ’</button>
            <button onclick="insertPhrase('ä¼šè®®è®°å½•ï¼š')">ä¼šè®®è®°å½•</button>
            <button onclick="insertPhrase('ä¸´æ—¶ä»»åŠ¡ï¼š')">ä¸´æ—¶ä»»åŠ¡</button>
        </div>
    </div>

    <div class="export-section">
        <button onclick="exportDoc()">ğŸ“¤ å¯¼å‡ºWordæ–‡æ¡£</button>
        <button onclick="backupData()">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
        <button onclick="restoreData()">ğŸ“¥ æ¢å¤æ•°æ®</button>
    </div>

    <script src="https://unpkg.com/docx@7.7.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

    <script>
        let currentDate = new Date();
        let entries = [];

        // åˆå§‹åŒ–ç³»ç»Ÿ
        function init() {
            updateDateDisplay();
            loadData();
            updateStats();
            setInterval(autoSave, 30000); // 30ç§’è‡ªåŠ¨ä¿å­˜
        }

        // æ—¥æœŸå¤„ç†ç›¸å…³å‡½æ•°
        function formatDate(date) {
            return `${date.getFullYear()}å¹´${pad(date.getMonth()+1)}æœˆ${pad(date.getDate())}æ—¥`;
        }

        function getDateKey(date) {
            return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())}`;
        }

        function pad(num) {
            return num.toString().padStart(2, '0');
        }

        // æ•°æ®å­˜å‚¨ç›¸å…³å‡½æ•°
        function saveData() {
            const data = {
                entries: entries,
                updatedAt: new Date().toISOString()
            };
            localStorage.setItem(getDateKey(currentDate), JSON.stringify(data));
        }

        function loadData() {
            const data = localStorage.getItem(getDateKey(currentDate));
            entries = data ? JSON.parse(data).entries : [];
            renderEntries();
            if (entries.length === 0) addEntry();
        }

        // ç•Œé¢æ¸²æŸ“å‡½æ•°
        function renderEntries() {
            const container = document.getElementById('entries');
            container.innerHTML = '';

            entries.forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'time-block';
                entryDiv.innerHTML = `
                    <div class="time">${entry.time}</div>
                    <textarea class="content" rows="2">${entry.content}</textarea>
                    <button class="delete-btn" onclick="deleteEntry(${index})">Ã—</button>
                `;

                const textarea = entryDiv.querySelector('textarea');
                textarea.addEventListener('input', () => {
                    entries[index].content = textarea.value;
                    saveData();
                    updateStats();
                });

                container.appendChild(entryDiv);
            });
        }

        // æ ¸å¿ƒåŠŸèƒ½å‡½æ•°
        function addEntry() {
            const time = new Date().toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit'
            });
            entries.push({
                time,
                content: ''
            });
            renderEntries();
            saveData();
            updateStats();
        }

        function deleteEntry(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®°å½•å—ï¼Ÿ')) {
                entries.splice(index, 1);
                renderEntries();
                saveData();
                updateStats();
            }
        }

        function changeDate(offset) {
            currentDate.setDate(currentDate.getDate() + offset);
            updateDateDisplay();
            loadData();
            updateStats();
        }

        // è¾…åŠ©åŠŸèƒ½å‡½æ•°
        function updateDateDisplay() {
            document.getElementById('dateHeader').textContent = formatDate(currentDate);
        }

        function updateStats() {
            const totalEntries = entries.length;
            const totalChars = entries.reduce((sum, entry) => sum + entry.content.length, 0);
            document.getElementById('stats').innerHTML = `
                ğŸ“Š ç»Ÿè®¡ï¼šä»Šæ—¥è®°å½•å— ${totalEntries} ä¸ªï¼Œæ€»å­—æ•° ${totalChars}
            `;
        }

        function insertPhrase(phrase) {
            if (entries.length === 0) addEntry();
            const lastEntry = entries[entries.length - 1];
            lastEntry.content += phrase;
            renderEntries();
            saveData();
        }

        // æ•°æ®å¤‡ä»½/æ¢å¤åŠŸèƒ½
        function backupData() {
            const allData = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    allData[key] = localStorage.getItem(key);
                }
            }
            const blob = new Blob([JSON.stringify(allData)], {
                type: 'application/json'
            });
            saveAs(blob, `daily-records-backup-${new Date().toISOString().slice(0,10)}.json`);
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = () => {
                    const data = JSON.parse(reader.result);
                    Object.keys(data).forEach(key => {
                        localStorage.setItem(key, data[key]);
                    });
                    alert('æ•°æ®æ¢å¤æˆåŠŸï¼');
                    location.reload();
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // å¯¼å‡ºåŠŸèƒ½
        async function exportDoc() {
            const doc = new docx.Document();

            // æ ‡é¢˜éƒ¨åˆ†
            doc.addSection({
                children: [
                    new docx.Paragraph({
                        text: formatDate(currentDate),
                        heading: docx.HeadingLevel.HEADING_1,
                        font: 'é»‘ä½“'
                    }),
                    new docx.Paragraph({
                        text: "",
                        border: {
                            bottom: {
                                color: "auto",
                                space: 1,
                                style: "single",
                                size: 6
                            }
                        }
                    })
                ]
            });

            // å†…å®¹éƒ¨åˆ†
            entries.forEach(entry => {
                doc.addSection({
                    children: [
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: entry.time,
                                    font: 'æ¥·ä½“'
                                }),
                                new docx.TextRun({
                                    text: "\t" + entry.content,
                                    font: 'ä»¿å®‹'
                                })
                            ],
                            spacing: {
                                after: 200
                            }
                        })
                    ]
                });
            });

            // ç”Ÿæˆæ–‡ä»¶
            const blob = await docx.Packer.toBlob(doc);
            saveAs(blob, `${formatDate(currentDate)}.docx`);
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>

</html>
