<!DOCTYPE html> <html> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>生成进度条图片 | 锦鲤未离</title> <style> body { background: #faebd7; } pre { white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; font-weight: lighter; } pre span { color: rgb(156, 0, 0); font-size: 14px; font-weight: bold; } table { width: 80%; margin: 20px auto; border-collapse: collapse; text-align: left; } th { padding: 10px; background-color: #0000002f; } td { padding: 10px; border: 1px solid #ddd; position: relative; } input { width: 100%; border: none; border-bottom: 2px solid black; background: #0000; outline: none; font-size: 16px; font-weight: normal; padding: 5px 0; } input:focus { font-weight: bold; border-bottom: 2px solid blue; } hr { border: 0; height: 1px; background-color: orange; margin: 20px 0; } details img { max-width: 100%; height: auto; } .interval-section { margin-bottom: 20px; } .button-group { display: flex; justify-content: center; gap: 10px; } button { padding: 10px 20px; background-color: #ffa500ba; color: white; border: none; cursor: pointer; font-size: 1em; border-radius: 20px; } button:hover { background-color: #FF8C00; } #image-canvas { display: block; margin: 20px auto; } .image-container img, #image-canvas { position: absolute; display: block; margin: 20px auto; transform: scale(0.10); transform-origin: top left; } .image-container img { display: none; } .image-container img:last-child { display: block; } #message { text-align: center; font-size: 18px; color: green; margin-bottom: 10px; } </style> <script src="/js/logo.js"></script> </head> <body> <h3 style="margin-bottom: -18px;">在Pr中输入参数并生成进度条图片 | 锦鲤未离</h3> <pre> <details><summary>我该怎么做？</summary> 第一步：根据要求输入正确的值，并且选择<span>两种</span>你心仪的颜色，保存<span>两张</span>图片。<br> 第二步：视频和图片导入Pr，『在右下方』将两张图片的长度拉到与视频<span>对应</span>的长度。<br> 第三步：『在左下方』的<span>效果</span>中搜索<span>裁剪</span>，拉入『右下方』<span>已到进度</span>粉色框框里。<br> 第四步：『在左上方』<span>效果控件</span>中找到<span>裁剪-右侧</span>，在『右上方』视频读秒在<span>00:00:00:0</span>时设置为<span>100%</span>。<br> 第五步：『在右上方』的视频读秒<span>移至末尾</span>，将『左上方』<span>裁剪-右侧</span>设置为<span>0%</span>。 <details><summary>点击打开Pr示意图</summary><img src="/imgs/posts/PrProgressBar.jpg"></details></details> </pre> <table style="margin-top: -30px;"> <tr> <th>视频帧宽度</th> <th>视频帧高度</th> <th>进度条高度</th> <th>进度条距离底部</th> <th>区域间间隔</th> <th>区域颜色</th> </tr> <tr> <td><input type="text" id="wwidth" value="2560"></td> <td><input type="text" id="hheight" value="1600"></td> <td><input type="text" id="progressbar_height" value="100"></td> <td><input type="text" id="near_bottom" value="0"></td> <td><input type="text" id="interregional_interval" value="5"></td> <td><input type="color" id="section_color" value="#B24222"> </td> </tr> </table> <form id="image-form"> <table id="intervals-table"> <tr> <th>序号</th> <th>时间 (格式: 分 秒)<br><span style="font-weight: initial;">起点最终时间：<br>0 0</span> <hr style="margin: 0;background: #000;"> </th> <th>标题</th> </tr> <tr> <td>1</td> <td>间隔1最终时间：<input type="text" class="interval" placeholder="例：9 9"></td> <td>起点—间隔1标题：<input type="text" class="legend" placeholder="请输入第1个区域标题"></td> </tr> <tr> <td>2</td> <td>终点时间：<input type="text" id="end_time" placeholder="例：59 9"></td> <td id="last-row-title">间隔1—终点标题：<input type="text" id="end_legend" class="legend" placeholder="请输入最后1个区域标题"></td> </tr> </table> <div class="button-group"> <button type="button" onclick="undoInterval()">撤销新间隔</button> <button type="button" onclick="addInterval()" style="font-weight: bold;">添加新间隔</button> <button type="button" onclick="generateImage()" style="font-weight: bold;">生成图片</button> <button type="button" onclick="resetPage()">重置页面</button> </div> <div id="message"></div> <div id="erroutput" style="display: none; "></div> </form> <img id="original-image" src="https://koihnl.github.io/imgs/TransparentPictures.png" style="display: none;"> <canvas id="image-canvas"></canvas> <div class="image-container"></div> <script> let generationCount = 0; function addInterval() { const intervalsTable = document.getElementById('intervals-table'); const intervalCount = intervalsTable.rows.length - 2; const newRow = intervalsTable.insertRow(intervalsTable.rows.length - 1); const serialCell = newRow.insertCell(0); serialCell.innerText = intervalCount + 1; const timeCell = newRow.insertCell(1); timeCell.innerHTML = `间隔${intervalCount + 1}最终时间：<input type="text" class="interval" placeholder="例：21 22">`; const titleCell = newRow.insertCell(2); titleCell.innerHTML = `间隔${intervalCount}—间隔${intervalCount + 1}标题：<input type="text" class="legend" placeholder="请输入第${intervalCount + 1}个区域标题">`; updateLastRowTitle(intervalCount + 1); } function undoInterval() { const intervalsTable = document.getElementById('intervals-table'); if (intervalsTable.rows.length > 3) { intervalsTable.deleteRow(intervalsTable.rows.length - 2); updateLastRowTitle(intervalsTable.rows.length - 2); } for (let i = 1; i < intervalsTable.rows.length - 1; i++) { intervalsTable.rows[i].cells[0].innerText = i; } } function updateLastRowTitle(intervalCount) { const lastRowTitle = document.getElementById('last-row-title'); const currentInput = lastRowTitle.querySelector('input'); const currentValue = currentInput ? currentInput.value : ''; const lastRow = document.getElementById('intervals-table').rows[document.getElementById('intervals-table').rows.length - 1]; lastRow.cells[0].innerText = intervalCount + 1; lastRowTitle.innerHTML = `间隔${intervalCount}—终点标题：<input type="text" class="legend" id="end_legend" value="${currentValue}" placeholder="请输入最后1个区域标题">`; } function resetPage() { location.reload(); } function generateImage() { if (!validateInputs()) { return; } document.querySelector('.image-container').innerHTML = ''; const wwidth = parseInt(document.getElementById('wwidth').value); const hheight = parseInt(document.getElementById('hheight').value); const progressbar_height = parseInt(document.getElementById('progressbar_height').value); const near_bottom = parseInt(document.getElementById('near_bottom').value); const interregional_interval = parseInt(document.getElementById('interregional_interval').value); const sectionColor = document.getElementById('section_color').value; const legends = Array.from(document.getElementsByClassName('legend')).map(input => input.value); const interval = Array.from(document.getElementsByClassName('interval')).map(input => input.value); const intervals = interval.map(time => parseTime(time)); const endtime = document.getElementById('end_time').value; const endTime = parseTime(document.getElementById('end_time').value);             const allresult = '0 0_' + interval.reduce((acc, interval, index) => { return acc + legends[index] + '_' + interval + '_'; }, '') + legends[legends.length - 1] + '-' + endtime; const constants = [0, ...intervals, endTime]; const totalTime = endTime; const originalImage = document.getElementById('original-image'); const canvas = document.getElementById('image-canvas'); const ctx = canvas.getContext('2d'); generationCount++; const messageDiv = document.getElementById('message'); messageDiv.innerHTML = `第${generationCount}次图片显示成功，下拉可见`; const existingDownloadLink = document.getElementById('download-PNG-link'); if (existingDownloadLink) { existingDownloadLink.remove(); } originalImage.onload = function () { canvas.width = wwidth; canvas.height = hheight; ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height); const rectHeight = progressbar_height; const rectWidth = canvas.width; const rectY = canvas.height - rectHeight - near_bottom; const sectionWidths = calculateSectionWidths(constants, rectWidth, totalTime); let startX = 0; for (let i = 0; i < sectionWidths.length; i++) { drawSection(startX, rectY, sectionWidths[i], rectHeight, sectionColor, legends[i] || ''); let outputDiv = document.getElementById('erroutput'); let valueDisplay = document.createElement('div'); valueDisplay.className = 'value-display'; valueDisplay.textContent = `Section ${i + 1}: ${sectionWidths[i]}px, ${startX},${rectY},${rectHeight},${sectionColor},${legends[i]},`; outputDiv.appendChild(valueDisplay); startX += sectionWidths[i] + interregional_interval + 2; } const imgData = canvas.toDataURL(); const resultImage = new Image(); resultImage.src = imgData; document.querySelector('.image-container').appendChild(resultImage); const downloadLink = document.createElement('a'); downloadLink.id = 'download-PNG-link'; downloadLink.style.display = 'flex'; downloadLink.style.justifyContent = 'center'; downloadLink.href = imgData; downloadLink.download = allresult + '.png'; downloadLink.innerHTML = '点击下载进度条图片['+allresult +'.png]'; document.body.appendChild(downloadLink); }; function parseTime(timeString) { const [minutes, seconds] = timeString.split(' ').map(Number); return minutes * 60 + seconds; } function calculateSectionWidths(constants, rectWidth, totalTime) { const sectionWidths = []; for (let i = 0; i < constants.length - 1; i++) { const duration = constants[i + 1] - constants[i]; sectionWidths.push(rectWidth * (duration / totalTime)); } return sectionWidths; } function drawSection(x, y, width, height, color, text) { ctx.clearRect(x, y, width, height); ctx.fillStyle = color; ctx.fillRect(x, y, width, height); ctx.fillStyle = 'white'; ctx.font = '64px Arial'; ctx.textAlign = 'center'; ctx.fillText(text, x + width / 2, y + height / 1.2); } originalImage.src = originalImage.src; } function validateInputs() { const wwidth = document.getElementById('wwidth').value.trim(); const hheight = document.getElementById('hheight').value.trim(); const progressbar_height = document.getElementById('progressbar_height').value.trim(); const near_bottom = document.getElementById('near_bottom').value.trim(); const interregional_interval = document.getElementById('interregional_interval').value.trim(); const sectionColor = document.getElementById('section_color').value.trim(); const intervals = Array.from(document.getElementsByClassName('interval')).map(input => input.value.trim()); const legends = Array.from(document.getElementsByClassName('legend')).map(input => input.value.trim()); const endTime = document.getElementById('end_time').value.trim(); const messageDiv = document.getElementById('message'); const timePattern = /^\d+\s+\d+$/; if (!wwidth || !hheight || !progressbar_height || !near_bottom || !interregional_interval || !sectionColor) { messageDiv.innerHTML = `图片生成失败，所有输入框都必须填写！`; return false; } countinterval = 1; for (let interval of intervals) { if (!interval || !timePattern.test(interval)) { messageDiv.innerHTML = `图片生成失败，第${countinterval}行时间格式不正确！请使用 "数字 数字" 格式。`; return false; } countinterval++; } if (!endTime || !timePattern.test(endTime)) { messageDiv.innerHTML = `图片生成失败，终点时间格式不正确！请使用 "数字 数字" 格式。`; return false; } countlegend = 1; for (let legend of legends) { if (!legend) { messageDiv.innerHTML = `图片生成失败，第${countlegend}行标题未填写，请填写所有标题！`; return false; } countlegend++; } return true; } </script> </body> </html>
