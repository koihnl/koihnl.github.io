<script>
    const data = [
        ["sijian1", "第一章", "关键词1", "这是第一章的示例内容，测试中文字符的换行规则和目录跳转功能。"],
        ["sijian2", "第二章", "关键词2", "这是第二章的示例内容，同样需要测试中文字符的换行规则和目录跳转功能。"],
        ["sijian3", "第三章", "关键词3", "这是第三章的示例内容，继续测试中文字符的换行规则和目录跳转功能。"]
    ];
</script>
<!DOCTYPE html>
<html lang="zh-CN"> <author name="锦鲤未离">
<head>
    <style> #toc-container { position: fixed; left: -30%; top: 0; height: 100vh; width: 30%; background: white; transition: left 0.3s; padding: 20px; box-sizing: border-box; overflow-y: auto; z-index: 1000; box-shadow: 2px 0 5px rgba(0,0,0,0.1); } #toc-container.active { left: 0; } #toc-list { list-style: none; padding: 0; } #toc-list li { margin: 10px 0; cursor: pointer; transition: all 0.3s; padding: 5px; } #toc-list li.active { background: #f0f0f0; transform: scale(1.05); } .MainPost { place-items: center; } pre { font-family: "仿宋", FangSong, serif; white-space: pre-wrap; line-height: 1.6; } @media (max-width: 768px) { #toc-container { width: 50%; left: -50%; } } </style>
</head>
<body>
    <div class="MainPost"></div> <div id="toc-container" class="active"> <ul id="toc-list"></ul></div>
    <script> const MainPost = document.querySelector('.MainPost'); const tocContainer = document.getElementById('toc-container'); const tocList = document.getElementById('toc-list'); const headings = []; data.forEach((item, index) => { const [sijian, title, guanjianci, content] = item; const postDiv = document.createElement('div'); postDiv.className = 'indexPost'; const h2 = document.createElement('h2'); h2.textContent = "["+sijian+"]"+guanjianci; h2.id = `heading-${index}`; headings.push(h2); const pre = document.createElement('pre'); pre.textContent = content; postDiv.appendChild(h2); postDiv.appendChild(pre); MainPost.appendChild(postDiv); const li = document.createElement('li'); li.innerHTML = `<a href="#${h2.id}">[${sijian}]${title}　${guanjianci}</a>`; li.addEventListener('click', (e) => { e.preventDefault(); const yOffset = h2.getBoundingClientRect().top + window.pageYOffset - 50; window.scrollTo({ top: yOffset, behavior: 'smooth' }); }); tocList.appendChild(li); }); const isScreenTooSmall = () => { const charWidth = 16; const minWidth = 25 * charWidth; return window.innerWidth < minWidth; }; document.querySelectorAll('pre').forEach(pre => { if (isScreenTooSmall()) { return; } const content = pre.textContent; const lines = []; let charCount = 0; let line = ''; for (let i = 0; i < content.length; i++) { const char = content[i]; if (/[A-Z0-9]/.test(char)) { charCount += 0.5; } else { charCount += 1; } line += char; if (charCount >= 25) { lines.push(line); line = ''; charCount = 0; } } if (line) { lines.push(line); } pre.textContent = lines.join('\n'); }); document.addEventListener('click', (e) => { if (!tocContainer.contains(e.target)) { tocContainer.classList.toggle('active'); } }); let ticking = false; window.addEventListener('scroll', () => { if (!ticking) { requestAnimationFrame(() => { const items = tocList.children; let activeIndex = -1; headings.forEach((h2, index) => { const rect = h2.getBoundingClientRect(); if (rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 3) { activeIndex = index; } }); Array.from(items).forEach((item, index) => { item.classList.toggle('active', index === activeIndex); if (index === activeIndex) { const itemTop = item.offsetTop; const itemHeight = item.offsetHeight; const containerHeight = tocContainer.offsetHeight; tocContainer.scrollTop = itemTop - containerHeight / 2 + itemHeight / 2; } }); ticking = false; }); ticking = true; } }); </script>
</body>
</html>
