<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¹é¤ | é”¦é²¤æœªç¦»</title>
    <!-- å¼•å…¥html2canvasåº“ -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="./js/logo.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "PingFang SC", "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            display: flex;
            background-color: #f5f5f5;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        .sidebar {
            width: 120px;
            background-color: #fff;
            overflow-y: auto;
            box-shadow: 1px 0 5px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }
        
        @media (max-width: 450px) {
            .sidebar {
                width: 80px;
            }
        }
        
        .sidebar-item {
            padding: 15px 10px;
            font-size: 14px;
            border-left: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sidebar-item.active {
            border-left: 4px solid #ff6b00;
            font-weight: bold;
            background-color: #fff8f0;
        }
        
        .sidebar-item.recommend {
            color: #ff6b00;
        }
        
        .content-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .search-container {
            padding: 10px 15px;
            background-color: #fff;
            position: sticky;
            top: 0;
            z-index: 20;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .search-input {
            width: 100%;
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
        }
        
        .search-input:focus {
            border-color: #ff6b00;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            padding: 15px;
            background-color: #fff;
            position: sticky;
            top: 0px;
            z-index: 10;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-top: 15px;
        }
        
        .content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }
        
        .section {
            margin-bottom: 20px;
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .dish {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }
        
        .dish:last-child {
            border-bottom: none;
        }
        
        .dish-info {
            flex: 1;
        }
        
        .dish-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .dish-desc {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }
        
        .dish-price {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            min-width: 80px;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: bold;
            color: #ff6b00;
        }
        
        .dish-controls {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        .quantity-btn {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background-color: #fff;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .quantity {
            margin: 0 10px;
            min-width: 20px;
            text-align: center;
        }
        
        .cart {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #ff6b00;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 10px rgba(255, 107, 0, 0.3);
            cursor: pointer;
            z-index: 100;
        }
        
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff0000;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fff;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        
        .order-total {
            font-weight: bold;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            text-align: right;
        }
        
        .modal-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }
        
        .export-btn {
            background-color: #ff6b00;
            color: white;
        }
        
        .close-btn {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .copy-btn {
            background-color: #2196F3;
            color: white;
        }
        
        .export-time {
            display: none;
            font-size: 12px;
            color: #999;
            text-align: center;
            margin-top: 15px;
        }
        
        .dish-img {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            object-fit: cover;
            margin-right: 15px;
            background-color: #f5f5f5;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
            color: #999;
            font-size: 16px;
        }
        /* å›¾ç‰‡æ‡’åŠ è½½ç›¸å…³æ ·å¼ */
        
        .dish-img.loading {
            background-color: #f5f5f5;
        }
        
        .dish-img.loaded {
            background-color: transparent;
        }
    </style>
</head>

<body>
    <div class="sidebar" id="sidebar"></div>

    <div class="content-container">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢èœå“...">
        </div>
        <div class="content" id="content"></div>
    </div>

    <div class="cart">
        ğŸ›’
        <div class="cart-badge">0</div>
    </div>

    <div class="modal" id="orderModal">
        <div class="modal-content" id="modalContent">
            <div class="modal-title">æ‚¨çš„è®¢å•</div>
            <div id="orderItems"></div>
            <div class="order-total" id="orderTotal">æ€»è®¡ï¼šï¿¥0</div>
            <div class="export-time" id="exportTime"></div>
            <div class="modal-actions">
                <button class="modal-btn close-btn" id="closeModal">å…³é—­</button>
                <button class="modal-btn copy-btn" id="copyText">å¤åˆ¶æ–‡æœ¬</button>
                <button class="modal-btn export-btn" id="exportTxt">å¯¼å‡ºæ–‡æœ¬</button>
                <button class="modal-btn export-btn" id="exportImg">å¯¼å‡ºå›¾ç‰‡</button>
            </div>
        </div>
    </div>

    <script>
        // èœå•æ•°æ®
        const simpleMenuData = [
            ["recommend", "æ‹›ç‰Œæ¨è", "ç¾Šè‚‰æ³¡é¦", "ä¼ ç»Ÿå£å‘³ï¼Œæ±¤é²œå‘³ç¾", 23, "#"],
            ["recommend", "æ‹›ç‰Œæ¨è", "ç‰›è‚‰æ³¡é¦", "ç²¾é€‰ç‰›è‚‰ï¼Œè‚‰è´¨é²œå«©", 25, "#"],
            ["recommend", "æ‹›ç‰Œæ¨è", "ä¸‰é²œæ³¡é¦", "æµ·é²œé£å‘³ï¼Œæ¸…æ·¡å¯å£", 20, "#"],
            ["special", "ç‰¹è‰²èœå“", "é…¸è¾£æ³¡é¦", "é…¸è¾£å¼€èƒƒï¼Œé£å‘³ç‹¬ç‰¹", 22, "#"],
            ["special", "ç‰¹è‰²èœå“", "éº»è¾£æ³¡é¦", "éº»è¾£é²œé¦™ï¼Œå›å‘³æ— ç©·", 24, "#"],
            ["setmeal", "å¥—é¤ç³»åˆ—", "å•äººå¥—é¤", "æ³¡é¦+å°èœ+é¥®æ–™", 30, "#"],
            ["setmeal", "å¥—é¤ç³»åˆ—", "åŒäººå¥—é¤", "ä¸¤ä»½æ³¡é¦+ä¸¤ä»½å°èœ+ä¸¤æ¯é¥®æ–™", 55, "#"]
        ];

        // const menuData = {categories: [{id: "recommend",name: "æ‹›ç‰Œæ¨è",title: "æ‹›ç‰Œæ¨è",items: [{name: "ç¾Šè‚‰æ³¡é¦",desc: "ä¼ ç»Ÿå£å‘³ï¼Œæ±¤é²œå‘³ç¾",price: 23,image: "https://img.picture.cn/dicm.jpg"}]}]};
        // è½¬æ¢å‡½æ•° == â†‘
        function convertMenuData(simpleData) {
            const categoriesMap = {};
            simpleData.forEach(item => {
                const [id, name, itemName, desc, price, image] = item;

                if (!categoriesMap[id]) {
                    categoriesMap[id] = {
                        id,
                        name,
                        title: name,
                        /* å‡è®¾title=name*/
                        items: []
                    };
                }
                categoriesMap[id].items.push({
                    name: itemName,
                    desc,
                    price,
                    image
                });
            });
            return {
                categories: Object.values(categoriesMap)
            };
        }
        const menuData = convertMenuData(simpleMenuData);
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            const sidebar = document.getElementById('sidebar');
            const content = document.getElementById('content');

            // ç”Ÿæˆå¯¼èˆªèœå•
            menuData.categories.forEach((category, index) => {
                const navItem = document.createElement('div');
                navItem.className = `sidebar-item ${index === 0 ? 'active recommend' : ''}`;
                navItem.textContent = category.name;
                navItem.setAttribute('data-section', category.id);
                sidebar.appendChild(navItem);
            });

            // ç”Ÿæˆå†…å®¹åŒºåŸŸ
            menuData.categories.forEach(category => {
                const section = document.createElement('div');
                section.className = 'section';
                section.id = category.id;
                section.dataset.category = category.id;

                if (category.title) {
                    const title = document.createElement('div');
                    title.className = 'section-title';
                    title.textContent = category.title;
                    section.appendChild(title);
                }

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'items-container';

                category.items.forEach((item, index) => {
                    const dish = document.createElement('div');
                    dish.className = 'dish';
                    dish.dataset.name = item.name.toLowerCase();
                    dish.dataset.desc = item.desc.toLowerCase();

                    const dishImg = document.createElement('img');
                    dishImg.className = 'dish-img loading';
                    dishImg.dataset.src = item.image;
                    dishImg.alt = item.name;

                    const dishInfo = document.createElement('div');
                    dishInfo.className = 'dish-info';

                    const dishName = document.createElement('div');
                    dishName.className = 'dish-name';
                    dishName.textContent = item.name;

                    const dishDesc = document.createElement('div');
                    dishDesc.className = 'dish-desc';
                    dishDesc.textContent = item.desc || '';

                    dishInfo.appendChild(dishName);
                    dishInfo.appendChild(dishDesc);

                    const dishPrice = document.createElement('div');
                    dishPrice.className = 'dish-price';

                    const currentPrice = document.createElement('div');
                    currentPrice.className = 'current-price';
                    currentPrice.textContent = `ï¿¥${item.price}`;
                    dishPrice.appendChild(currentPrice);

                    const controls = document.createElement('div');
                    controls.className = 'dish-controls';

                    const minusBtn = document.createElement('button');
                    minusBtn.className = 'quantity-btn minus';
                    minusBtn.textContent = '-';

                    const quantity = document.createElement('span');
                    quantity.className = 'quantity';
                    quantity.textContent = '0';

                    const plusBtn = document.createElement('button');
                    plusBtn.className = 'quantity-btn plus';
                    plusBtn.textContent = '+';

                    controls.appendChild(minusBtn);
                    controls.appendChild(quantity);
                    controls.appendChild(plusBtn);
                    dishPrice.appendChild(controls);

                    dish.appendChild(dishImg);
                    dish.appendChild(dishInfo);
                    dish.appendChild(dishPrice);
                    itemsContainer.appendChild(dish);
                });

                section.appendChild(itemsContainer);
                content.appendChild(section);
            });

            // åˆå§‹åŠ è½½å¯è§†åŒºåŸŸå›¾ç‰‡
            lazyLoadImages();
        }

        // å›¾ç‰‡æ‡’åŠ è½½
        function lazyLoadImages() {
            const images = document.querySelectorAll('.dish-img.loading');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.onload = () => {
                            img.classList.remove('loading');
                            img.classList.add('loaded');
                        };
                        observer.unobserve(img);
                    }
                });
            }, {
                rootMargin: '0px 0px 100px 0px'
            });

            images.forEach(img => {
                observer.observe(img);
            });
        }

        // å¯¼èˆªåˆ‡æ¢å’Œæ»šåŠ¨é«˜äº®
        function setupNavigation() {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            const sections = document.querySelectorAll('.section');
            const content = document.getElementById('content');

            // ç‚¹å‡»å¯¼èˆªåˆ‡æ¢
            sidebarItems.forEach(item => {
                item.addEventListener('click', () => {
                    const sectionId = item.getAttribute('data-section');
                    const section = document.getElementById(sectionId);

                    // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
                    sidebarItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');

                    // æ»šåŠ¨åˆ°å¯¹åº”åŒºåŸŸ
                    section.scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // æ»šåŠ¨æ—¶é«˜äº®å¯¹åº”å¯¼èˆª
            content.addEventListener('scroll', () => {
                const scrollPosition = content.scrollTop + 100;

                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;

                    if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                        const sectionId = section.id;
                        sidebarItems.forEach(item => {
                            item.classList.remove('active');
                            if (item.getAttribute('data-section') === sectionId) {
                                item.classList.add('active');
                            }
                        });
                    }
                });
            });
        }

        // æœç´¢åŠŸèƒ½
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const dishes = document.querySelectorAll('.dish');
            const sections = document.querySelectorAll('.section');

            searchInput.addEventListener('input', (e) => {
                const keyword = e.target.value.trim().toLowerCase();

                if (keyword === '') {
                    // æ¢å¤åŸå§‹æ˜¾ç¤º
                    sections.forEach(section => {
                        section.style.display = 'block';
                        section.querySelectorAll('.dish').forEach(dish => {
                            dish.style.display = 'flex';
                        });
                    });
                    return;
                }

                let hasResults = false;

                sections.forEach(section => {
                    let sectionHasResults = false;
                    section.querySelectorAll('.dish').forEach(dish => {
                        const name = dish.dataset.name;
                        const desc = dish.dataset.desc;

                        if (name.includes(keyword)) { /*TWO:name.includes(keyword) || desc.includes(keyword)*/
                            dish.style.display = 'flex';
                            sectionHasResults = true;
                            hasResults = true;
                        } else {
                            dish.style.display = 'none';
                        }
                    });

                    // æ˜¾ç¤º/éšè—æ•´ä¸ªæ¿å—
                    section.style.display = sectionHasResults ? 'block' : 'none';
                });

                // æ˜¾ç¤ºæ— ç»“æœæç¤º
                const noResults = document.getElementById('noResults');
                if (!hasResults) {
                    if (!noResults) {
                        const noResultsDiv = document.createElement('div');
                        noResultsDiv.id = 'noResults';
                        noResultsDiv.className = 'no-results';
                        noResultsDiv.textContent = 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èœå“';
                        document.getElementById('content').appendChild(noResultsDiv);
                    }
                } else if (noResults) {
                    noResults.remove();
                }
            });
        }

        // è´­ç‰©è½¦åŠŸèƒ½
        function setupCart() {
            const cart = {};
            const cartBadge = document.querySelector('.cart-badge');
            const cartBtn = document.querySelector('.cart');
            const orderModal = document.getElementById('orderModal');
            const orderItems = document.getElementById('orderItems');
            const orderTotal = document.getElementById('orderTotal');
            const exportTime = document.getElementById('exportTime');
            const closeModal = document.getElementById('closeModal');
            const copyText = document.getElementById('copyText');
            const exportTxt = document.getElementById('exportTxt');
            const exportImg = document.getElementById('exportImg');

            // åˆå§‹åŒ–èœå“æ•°é‡æ§åˆ¶
            document.querySelectorAll('.dish').forEach((dish, index) => {
                const minusBtn = dish.querySelector('.minus');
                const plusBtn = dish.querySelector('.plus');
                const quantity = dish.querySelector('.quantity');
                const dishName = dish.querySelector('.dish-name').textContent;
                const priceElement = dish.querySelector('.current-price');

                if (priceElement && priceElement.textContent) {
                    const priceText = priceElement.textContent;
                    const currentPrice = parseFloat(priceText.replace('ï¿¥', ''));

                    // åˆå§‹åŒ–è´­ç‰©è½¦ä¸­çš„èœå“
                    cart[index] = {
                        name: dishName,
                        price: currentPrice,
                        quantity: 0
                    };

                    // å‡æŒ‰é’®
                    if (minusBtn) {
                        minusBtn.addEventListener('click', () => {
                            if (cart[index].quantity > 0) {
                                cart[index].quantity--;
                                quantity.textContent = cart[index].quantity;
                                updateCart();
                            }
                        });
                    }

                    // åŠ æŒ‰é’®
                    if (plusBtn) {
                        plusBtn.addEventListener('click', () => {
                            cart[index].quantity++;
                            quantity.textContent = cart[index].quantity;
                            updateCart();
                        });
                    }
                }
            });

            // æ›´æ–°è´­ç‰©è½¦
            function updateCart() {
                let totalItems = 0;
                let totalPrice = 0;

                for (const item in cart) {
                    totalItems += cart[item].quantity;
                    totalPrice += cart[item].quantity * cart[item].price;
                }

                cartBadge.textContent = totalItems;
            }

            // æ˜¾ç¤ºè®¢å•æ¨¡æ€æ¡†
            cartBtn.addEventListener('click', showOrderModal);

            function showOrderModal() {
                let itemsHtml = '';
                let totalPrice = 0;

                for (const item in cart) {
                    if (cart[item].quantity > 0) {
                        itemsHtml += `
                            <div class="order-item">
                                <div>${cart[item].name} Ã— ${cart[item].quantity}</div>
                                <div>ï¿¥${(cart[item].price * cart[item].quantity).toFixed(2)}</div>
                            </div>
                        `;
                        totalPrice += cart[item].price * cart[item].quantity;
                    }
                }

                if (itemsHtml === '') {
                    itemsHtml = '<div style="text-align: center; color: #999;">è´­ç‰©è½¦æ˜¯ç©ºçš„</div>';
                }

                orderItems.innerHTML = itemsHtml;
                orderTotal.textContent = `æ€»è®¡ï¼šï¿¥${totalPrice.toFixed(2)}`;

                // æ›´æ–°å¯¼å‡ºæ—¶é—´æ˜¾ç¤º
                const now = new Date();
                exportTime.textContent = `å¯¼å‡ºæ—¶é—´: ${now.toLocaleString()}`;

                orderModal.style.display = 'flex';
            }

            // å…³é—­æ¨¡æ€æ¡†
            closeModal.addEventListener('click', () => {
                orderModal.style.display = 'none';
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            orderModal.addEventListener('click', (e) => {
                if (e.target === orderModal) {
                    orderModal.style.display = 'none';
                }
            });

            // å¤åˆ¶è®¢å•æ–‡æœ¬
            // å¤åˆ¶è®¢å•æ–‡æœ¬
            copyText.addEventListener('click', () => {
                let orderText = '=== ç‚¹é¤å• ===\n\n';
                let totalPrice = 0;

                for (const item in cart) {
                    if (cart[item].quantity > 0) {
                        orderText += `${cart[item].name} Ã— ${cart[item].quantity} = ï¿¥${(cart[item].price * cart[item].quantity).toFixed(2)}\n`;
                        totalPrice += cart[item].price * cart[item].quantity;
                    }
                }

                orderText += `\næ€»è®¡ï¼šï¿¥${totalPrice.toFixed(2)}`;
                orderText += `\n\nä¸‹å•æ—¶é—´ï¼š${new Date().toLocaleString()}`;

                // ä½¿ç”¨Clipboard APIå¤åˆ¶æ–‡æœ¬
                navigator.clipboard.writeText(orderText).then(() => {
                    // ä¿®æ”¹æŒ‰é’®æ–‡æœ¬å’Œæ ·å¼
                    copyText.textContent = 'å·²å¤åˆ¶';
                    copyText.style.backgroundColor = '#45a049'; // æ›´æ·±çš„ç»¿è‰²

                    // 3ç§’åæ¢å¤åŸæ ·å¼
                    setTimeout(() => {
                        copyText.textContent = 'å¤åˆ¶æ–‡æœ¬';
                        copyText.style.backgroundColor = '#2196F3'; // æ¢å¤åŸè“è‰²
                    }, 3000);
                }).catch(err => {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶: ' + err);
                });
            });

            // å¯¼å‡ºè®¢å•æ–‡æœ¬
            exportTxt.addEventListener('click', () => {
                let orderText = '=== ç‚¹é¤å• ===\n\n';
                let totalPrice = 0;

                for (const item in cart) {
                    if (cart[item].quantity > 0) {
                        orderText += `${cart[item].name} Ã— ${cart[item].quantity} = ï¿¥${(cart[item].price * cart[item].quantity).toFixed(2)}\n`;
                        totalPrice += cart[item].price * cart[item].quantity;
                    }
                }

                orderText += `\næ€»è®¡ï¼šï¿¥${totalPrice.toFixed(2)}`;
                orderText += `\n\nä¸‹å•æ—¶é—´ï¼š${new Date().toLocaleString()}`;

                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([orderText], {
                    type: 'text/plain'
                });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                const now = new Date();
                a.download = `ç‚¹é¤å•T${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });

            // å¯¼å‡ºè®¢å•å›¾ç‰‡
            exportImg.addEventListener('click', async() => {
                try {
                    // å…‹éš†æ¨¡æ€æ¡†å†…å®¹ï¼Œç”¨äºå¯¼å‡º
                    const modalContent = document.getElementById('modalContent');
                    const clone = modalContent.cloneNode(true);

                    // éšè—ä¸éœ€è¦å¯¼å‡ºçš„å…ƒç´ 
                    const actions = clone.querySelector('.modal-actions');
                    if (actions) actions.style.display = 'none';

                    // æ›´æ–°å¯¼å‡ºæ—¶é—´
                    const now = new Date();
                    const exportTime = clone.querySelector('.export-time');
                    if (actions) exportTime.style.display = 'block';
                    if (exportTime) exportTime.textContent = `å¯¼å‡ºæ—¶é—´: ${now.toLocaleString()}`;

                    // ä¸´æ—¶æ·»åŠ åˆ°DOMä¸­
                    clone.style.position = 'absolute';
                    clone.style.left = '-9999px';
                    document.body.appendChild(clone);

                    // ä½¿ç”¨html2canvaså°†è´­ç‰©è½¦å†…å®¹è½¬ä¸ºå›¾ç‰‡
                    const canvas = await html2canvas(clone, {
                        backgroundColor: null,
                        scale: 2 // æé«˜å›¾ç‰‡è´¨é‡
                    });

                    // ç§»é™¤ä¸´æ—¶å…ƒç´ 
                    document.body.removeChild(clone);

                    // è½¬æ¢ä¸ºå›¾ç‰‡URL
                    const imageData = canvas.toDataURL('image/png');

                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const a = document.createElement('a');
                    a.href = imageData;
                    a.download = `è®¢å•T${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                } catch (error) {
                    alert('å¯¼å‡ºå›¾ç‰‡å¤±è´¥: ' + error.message);
                }
            });
        }

        // åˆå§‹åŒ–é¡µé¢
        initPage();
        setupNavigation();
        setupSearch();
        setupCart();

        // ç›‘å¬æ»šåŠ¨äº‹ä»¶å®ç°å›¾ç‰‡æ‡’åŠ è½½
        document.getElementById('content').addEventListener('scroll', lazyLoadImages);
    </script>
</body>

</html>
